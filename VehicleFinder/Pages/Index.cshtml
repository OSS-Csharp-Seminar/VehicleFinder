@page
@model VehicleFinder.Pages.IndexModel
@using VehicleFinder.Enums
@{
    ViewData["Title"] = "Home page";
}

<h1 class="display-4 text-center my-4">Welcome to VehicleFinder</h1>

<div class="container-fluid">
    <div class="row">
        <div class="col-md-3">
            <div class="sidebar bg-light p-3">
                <h2>Filters</h2>
                <form method="get">
                    <div class="form-group">
                        <label for="title">Title</label>
                        <input type="text" class="form-control" id="title" name="title" value="@Model.Title" placeholder="Search by Title" />
                    </div>
                    <div class="form-group">
                        <label for="brand">Brand</label>
                        <input type="text" class="form-control" id="brand" name="brand" value="@Model.Brand" placeholder="Vehicle Brand" />
                    </div>
                    <div class="form-group">
                        <label for="model">Model</label>
                        <input type="text" class="form-control" id="model" name="model" value="@Model.Model" placeholder="Vehicle Model" />
                    </div>
                    <div class="form-group">
                        <label for="yearMin">Min Manufacturing Year</label>
                        <input type="number" class="form-control" id="yearMin" name="yearMin" value="@Model.YearMin" placeholder="Minimum Year" />
                    </div>
                    <div class="form-group">
                        <label for="yearMax">Max Manufacturing Year</label>
                        <input type="number" class="form-control" id="yearMax" name="yearMax" value="@Model.YearMax" placeholder="Maximum Year" />
                    </div>
                    <div class="form-group">
                        <label for="priceMin">Min Price</label>
                        <input type="number" class="form-control" id="priceMin" name="priceMin" value="@Model.PriceMin" placeholder="Minimum Price" />
                    </div>
                    <div class="form-group">
                        <label for="priceMax">Max Price</label>
                        <input type="number" class="form-control" id="priceMax" name="priceMax" value="@Model.PriceMax" placeholder="Maximum Price" />
                    </div>
                    <div class="form-group">
                        <label for="isSold">Is Sold</label>
                        <select class="form-control" id="isSold" name="isSold">
                            <option value="">Any</option>
                            <option value="true" selected=@(Model.IsSold.HasValue && Model.IsSold.Value ? "selected" : "")>Yes</option>
                            <option value="false" selected=@(Model.IsSold.HasValue && !Model.IsSold.Value ? "selected" : "")>No</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="engine-name">Engine name</label>
                        <input type="text" class="form-control" id="enginename" name="enginename" value="@Model.EngineName" placeholder="Search by engine name" />
                    </div>
                    <div class="form-group">
                        <label for="fuelType">Fuel Type</label>
                        <select class="form-control" id="fuelType" name="fuelType">
                            <option value="">Any</option>
                            @foreach (var option in Model.FuelTypeOptions)
                            {
                                <option value="@option.Value" selected="@option.Selected">@option.Text</option>
                            }
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="horsepowerMin">Min Horsepower</label>
                        <input type="number" class="form-control" id="horsepowerMin" name="horsepowerMin" value="@Model.HorsepowerMin" placeholder="Minimum Horsepower" />
                    </div>
                    <div class="form-group">
                        <label for="horsepowerMax">Max Horsepower</label>
                        <input type="number" class="form-control" id="horsepowerMax" name="horsepowerMax" value="@Model.HorsepowerMax" placeholder="Maximum Horsepower" />
                    </div>
                    <div class="form-group">
                        <label for="doorCount">Door Count</label>
                        <input type="number" class="form-control" id="doorCount" name="doorCount" value="@Model.DoorCount" placeholder="Door Count" />
                    </div>
                    <div class="form-group">
                        <label for="seatCount">Seat Count</label>
                        <input type="number" class="form-control" id="seatCount" name="seatCount" value="@Model.SeatCount" placeholder="Seat Count" />
                    </div>
                    <div class="form-group">
                        <label for="bodyShape">Body Shape</label>
                        <select class="form-control" id="bodyShape" name="bodyShape">
                            <option value="">Any</option>
                            @foreach (var option in Model.BodyShapeOptions)
                            {
                                <option value="@option.Value" selected="@option.Selected">@option.Text</option>
                            }
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="acType">AC Type</label>
                        <select class="form-control" id="acType" name="acType">
                            <option value="">Any</option>
                            @foreach (var option in Model.ACTypeOptions)
                            {
                                <option value="@option.Value" selected="@option.Selected">@option.Text</option>
                            }
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="drivetrainType">Drivetrain Type</label>
                        <select class="form-control" id="drivetrainType" name="drivetrainType">
                            <option value="">Any</option>
                            @foreach (var option in Model.DrivetrainTypeOptions)
                            {
                                <option value="@option.Value" selected="@option.Selected">@option.Text</option>
                            }
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="shifterType">Shifter Type</label>
                        <select class="form-control" id="shifterType" name="shifterType">
                            <option value="">Any</option>
                            @foreach (var option in Model.ShifterTypeOptions)
                            {
                                <option value="@option.Value" selected="@option.Selected">@option.Text</option>
                            }
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">Apply Filters</button>
                </form>
            </div>
        </div>
        <div class="col-md-9">
            <h2>Listings</h2>
            <div class="row">
                @foreach (var listing in Model.Listings)
                {
                    <div class="col-md-6">
                        <div class="card mb-4 shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title">@listing.Title</h5>
                               @*  <h6 class="card-subtitle mb-2 text-muted">@listing.Vehicle.Brand @listing.Vehicle.Model (@listing.Vehicle.ManufacturingYear)</h6> *@
                                <p class="card-text">@listing.Description</p>
                                <ul class="list-unstyled">
                                    <li><strong>Price:</strong> $@listing.Price</li>
                                    <li><strong>Kilometers:</strong> @listing.Vehicle.Kilometers km</li>
                                    <li><strong>Registration Until:</strong> @listing.Vehicle.RegistrationUntil</li>
                                    <li><strong>Number of Previous Owners:</strong> @listing.Vehicle.NumberOfPreviousOwners</li>
                                    <li><strong>Is Sold:</strong> @(listing.IsSold ? "Yes" : "No")</li>
                                </ul>
                                <a asp-area="Listing" asp-page="/ListingDetails" asp-route-id="@listing.Id" class="btn btn-primary">View Details</a>
                                @if (Model.CurrentUserId == listing.UserId)
                                {
                                    <a asp-area="Listing" asp-page="/EditListing" asp-route-id="@listing.Id" class="btn btn-warning">Edit</a>
                                    <button class="btn btn-danger" onclick="confirmMarkAsSold('@listing.Id')">Mark as Sold</button>
                                }

                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function confirmMarkAsSold(listingId) {
            if (confirm("Are you sure you want to mark this listing as sold?")) {
                fetch(`/MarkAsSold?id=${listingId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'RequestVerificationToken': $('input[name="__RequestVerificationToken"]').val()
                    }
                }).then(response => {
                    if (response.ok) {
                        location.reload();
                    } else {
                        alert('Failed to mark as sold.');
                    }
                });
            }
        }
    </script>
}
